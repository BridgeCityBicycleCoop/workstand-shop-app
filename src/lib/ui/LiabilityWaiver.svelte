<script lang="ts">
	import { format } from 'date-fns';

	export let name: string = '';
	export let requiresGuardian: boolean = false;
	export let guardianName: string | null = '';

	let waiverDate = format(Date.now(), 'LLLL dd, yyyy');

	const toggleCollapsibleContent = (ev: MouseEvent) => {
		const el = <HTMLElement>ev.target;
		el?.classList.toggle('active');
		const content = <HTMLElement>el.nextElementSibling;
		if (content) {
			if (content.style.maxHeight) {
				content.style.maxHeight = '';
			} else {
				content.style.maxHeight = content.scrollHeight + 'px';
			}
		}
	};
</script>

<div class="wavier-container">
	<h2 class="wavier-title">Member Liability Waiver</h2>
	<small>
		***Children under the age of 18 must have a parent or guardian co-sign the following waiver
		form.
	</small>
	<small>
		***Children under the age of 13 must have guardian supervision when participating in BCBC
		activities and events.
	</small>
	<button class="collapsible" on:click={toggleCollapsibleContent}>Show Waiver</button>
	<div class="collapsible-content">
		<p>
			The Bridge City Bicycle Co-operative (herein referred to as The BCBC and The Community) is a
			nonprofit, community bicycle repair education and resource co-operative. We offer our members
			nonjudgmental repair space, tools and instruction during business hours (hours on website) by
			donation, and educational workshops. We also offer reconditioned/recycled low cost bikes and
			parts for sale. The BCBC is operated by volunteers; a medley of professionals, students, bike
			enthusiasts, activists, and other community members who share a love for cycling in Saskatoon.
			Membership is open to all individuals and is free for anyone to get. Contact Info Used to
			inform you of upcoming events â€“ Please print clearly
		</p>
		<p>
			By signing this form in the space provided below, I hereby assume all of the risks of
			participating and/or volunteering in the Bridge City Bicycle Co-operative, hereinafter
			referred to as the BCBC and the Community. I realize that liability may arise from negligence
			or carelessness on the part of the persons or entities being released, from dangerous or
			defective equipment or property owned, maintained or controlled by them or because of their
			possible liability without fault. I acknowledge that this Accident Waiver and Release of
			Liability form will be used by the Community, sponsors and organizers, in which I may
			participate and that it will govern my actions and responsibilities during my use of its
			services. In consideration of my application and permitting me to participate in this program,
			I hereby take action for myself, my executors, administrators, heirs, next of kin, successors,
			and assigns as follows: (A) Waive, Release and Discharge from any and all liability for my
			death, disability, personal injury, property damage, property theft or actions of any kind
			which may hereafter accrue to me including my traveling to and from space or using the shop's
			bicycle, equipment or other facilities, THE FOLLOWING ENTITIES OR PERSONS: The directors,
			officers, employees, volunteers, representatives, and agents, the event holders, sponsors,
			volunteers of the Community; (B) Indemnify and Hold Harmless the entities and persons set
			forth in (A) above from any and all liabilities and claims arising from my participation in
			the Community, including my use of a bicycle belonging to the Community, irrespective of
			whether the cause of the claims or liability arise from the negligence, acts or omissions of
			me, a third party, or the Community.
		</p>
	</div>
	<div class="wavier-signature">
		<p>I {name} have read and agree to the above terms & conditions.</p>
		<p>Date: {waiverDate}</p>
		{#if requiresGuardian}
			<p>Guardian Name (if under 18): {guardianName ?? ''}</p>
			<p>Guardian Signature: <span class="signature">{guardianName ?? ''}</span></p>
		{:else}
			<p>Signature: <span class="signature">{name}</span></p>
		{/if}
	</div>
</div>

<style>
	small {
		display: block;
		margin-bottom: 1em;
	}
	.signature {
		font-style: italic;
		font-weight: bold;
	}

	.collapsible {
		background-color: #777;
		color: white;
		cursor: pointer;
		padding: 18px;
		width: 100%;
		border: none;
		text-align: left;
		outline: none;
		font-size: 15px;
	}

	.active,
	.collapsible:hover {
		background-color: #555;
	}

	.collapsible:after {
		content: '\002B';
		color: white;
		font-weight: bold;
		float: right;
		margin-left: 5px;
	}

	.active:after {
		content: '\2212';
	}

	.collapsible-content {
		padding: 0 18px;
		max-height: 0;
		overflow: hidden;
		transition: max-height 0.2s ease-out;
		background-color: #f1f1f1;
	}
</style>
